#! /bin/bash

function parse_git_dirty {
	git diff --no-ext-diff --quiet --exit-code &> /dev/null || echo "*"
}

function parse_git_branch {
	git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/(\1$(parse_git_dirty))/"
}

export PS1="\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;36m\]\w\[\033[00m\]\$(parse_git_branch)\$ "
export CLICOLOR=1

alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

#Make prebuilt tools executable
chmod -R 0700 $HOME/dotfiles/.tools/

#If cygwin
if [ -f $HOME/start-agent-trigger ]; then 
    eval "$(ssh-agent -s)"
    ssh-add $HOME/.ssh/web-dev
    ssh-add $HOME/.ssh/gHub_rsa
    ssh-add $HOME/.ssh/ko-dev
#Actual Linux distro
else
    export WINEARCH=win32
    #export WINEARCH=win64
    export WINEPREFIX=$HOME/.wine
    export JAVAHOME=/opt/jdk/bin
    export JAVA_HOME=/opt/jdk/bin
    export SMARTGITHG_JAVA_HOME=/opt/jdk/bin
    export TEXMFHOME=$HOME/texmf
    export EDITOR='emacs -nw'

    #Start 'conky' if startup script exists.
    if [ -f $HOME/.conky/conky-startup.sh ]; then
        chmod +x $HOME/.conky/conky-startup.sh
        $HOME/.conky/conky-startup.sh
    fi

    # Haskell and Elixir
    export PATH=~/.cabal/bin:/opt/cabal/1.20/bin:/opt/ghc/7.8.4/bin:$PATH
    export PATH="$PATH:$(which elixir)"

    #http://virtualenvwrapper.readthedocs.org/en/latest/install.html#lazy-loading
    export WORKON_HOME=$HOME/.virtualenvs
    export PROJECT_HOME=$HOME/Projects
    export VIRTUALENVWRAPPER_SCRIPT=/usr/local/bin/virtualenvwrapper.sh
    
    VIRTUALENVWRAPPER_PREFIX="/usr/local/bin/virtualenvwrapper"
    if [ -f "$VIRTUALENVWRAPPER_PREFIX"_lazy.sh ]; then
        source "$VIRTUALENVWRAPPER_PREFIX"_lazy.sh
    else
	if [ -f "$VIRTUALENVWRAPPER_PREFIX".sh
	    source "$VIRTUALENVWRAPPER_PREFIX".sh
	fi
    fi

    if [ -f $HOME/.gvm/scripts/gvm ]; then
        source $HOME/.gvm/scripts/gvm
    fi
fi

